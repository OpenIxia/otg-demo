name: obgpd

topology:
  nodes:
    ixp:
      kind: bridge
      labels:
        graph-level: 2
        graph-icon: switch
    r1:
      kind: nokia_srlinux
      image: ghcr.io/nokia/srlinux:22.6.4
      startup-config: srlinux.cfg
      labels:
        graph-level: 3
    r2:
      kind: arista_ceos
      image: ceos:latest
      startup-config: ceos.cfg
      labels:
        graph-level: 3
    openbgpd:
      kind: linux
      image: quay.io/openbgpd/openbgpd:7.7
      binds:
        - ./openbgpd.conf:/etc/bgpd/bgpd.conf
      exec:
        - "ip address add dev eth1 192.168.0.3/24"
      labels:
        graph-level: 1
        graph-icon: server
    otg:
      kind: linux
      image: ghcr.io/open-traffic-generator/licensed/ixia-c-controller:0.0.1-3587
      network-mode: host
      cmd: --accept-eula --http-port 443
      ports:
        - 443:443
      labels:
        graph-hide: yes
    te1:
      kind: linux
      image: ghcr.io/open-traffic-generator/ixia-c-traffic-engine:1.6.0.19
      ports:
        - 5555:5555
        - 50071:50071
      env:
        OPT_LISTEN_PORT: 5555
        ARG_IFACE_LIST: virtual@af_packet,eth1
        OPT_NO_HUGEPAGES: Yes
        OPT_NO_PINNING: Yes
        WAIT_FOR_IFACE: Yes
      labels:
        graph-level: 4
        graph-icon: server
    pe1:
      kind: linux
      image: ghcr.io/open-traffic-generator/licensed/ixia-c-protocol-engine:1.00.0.236
      network-mode: container:te1
      startup-delay: 5
      env:
        INTF_LIST: eth1
      labels:
        graph-hide: yes
    te2:
      kind: linux
      image: ghcr.io/open-traffic-generator/ixia-c-traffic-engine:1.6.0.19
      ports:
        - 5556:5556
        - 50072:50071
      env:
        OPT_LISTEN_PORT: 5556
        ARG_IFACE_LIST: virtual@af_packet,eth1
        OPT_NO_HUGEPAGES: Yes
        OPT_NO_PINNING: Yes
        WAIT_FOR_IFACE: Yes
      labels:
        graph-level: 4
        graph-icon: server
    pe2:
      kind: linux
      image: ghcr.io/open-traffic-generator/licensed/ixia-c-protocol-engine:1.00.0.236
      network-mode: container:te2
      startup-delay: 5
      env:
        INTF_LIST: eth1
      labels:
        graph-hide: yes

    graphite:
      kind: linux
      image: netreplica/graphite:latest
      env:
        CLAB_SSH_CONNECTION: ${SSH_CONNECTION}
      binds:
        - __clabDir__/topology-data.json:/htdocs/default/default.json:ro
      ports:
        - 8080:80
      exec:
        - sh -c 'graphite_motd.sh 8080'
      labels:
        graph-hide: yes

  links:
    - endpoints: ["openbgpd:eth1", "ixp:eth3"]
    - endpoints: ["r1:e1-1", "ixp:eth1"]
    - endpoints: ["r1:e1-2", "te1:eth1"]
    - endpoints: ["r2:eth1", "ixp:eth2"]
    - endpoints: ["r2:eth2", "te2:eth1"]
